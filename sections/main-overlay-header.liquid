{% assign overlay_id = section.id | replace: '_', '' | downcase %}

{{ 'main-overlay-header.css' | asset_url | stylesheet_tag }}
{{ 'main-overlay-header.js' | asset_url | script_tag }}

<style>
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] {
    --kk-icon-size-desktop: {{ section.settings.icon_size_desktop | default: 28 }}px;
    --kk-icon-size-mobile: {{ section.settings.icon_size_mobile | default: 24 }}px;

    --header-bg-color: {{ section.settings.header_bg_color }};
    --header-border-color: {{ section.settings.header_border_color }};
    --header-border-thickness: {{ section.settings.header_border_thickness }}px;

    --header-margin-mobile: {{ section.settings.header_margin_mobile }}px;
    --header-height-mobile: {{ section.settings.header_height_mobile }}px;

    --logo-height-mobile: {{ section.settings.logo_height_mobile }}px;
    --logo-height-desktop: {{ section.settings.logo_height_desktop }}px;

    --nav-text-color: {{ section.settings.nav_text_color }};
    --nav-spacing-desktop: {{ section.settings.nav_spacing_desktop }}px;
    --nav-item-spacing-desktop: {{ section.settings.nav_item_spacing_desktop }}px;
    --nav-font-size-desktop: {{ section.settings.nav_font_size_desktop }}px;
    --nav-font-weight: {{ section.settings.nav_font_weight }};
    --nav-item-padding-desktop: {{ section.settings.nav_item_padding_desktop }}px;

    --dropdown-bg-color: {{ section.settings.dropdown_bg_color }};
    --dropdown-border-color: {{ section.settings.dropdown_border_color }};
    --dropdown-border-radius: {{ section.settings.dropdown_border_radius }}px;
    --dropdown-text-color: {{ section.settings.dropdown_text_color }};
    --dropdown-hover-bg-color: {{ section.settings.dropdown_hover_bg_color }};
    --dropdown-hover-text-color: {{ section.settings.dropdown_hover_text_color }};
    --dropdown-font-size: {{ section.settings.dropdown_font_size }}px;

    --icon-spacing: {{ section.settings.icon_spacing }}px;
    --search-icon-color-desktop: {{ section.settings.search_icon_color_desktop }};
    --account-icon-color-desktop: {{ section.settings.account_icon_color_desktop }};
    --cart-icon-color-desktop: {{ section.settings.cart_icon_color_desktop }};

    --header-margin-desktop: {{ section.settings.header_margin_desktop }}px;
    --header-height-desktop: {{ section.settings.header_height_desktop }}px;

    --overlay-bg-color: {{ section.settings.overlay_bg_color }};
    --overlay-text-color: {{ section.settings.overlay_text_color }};
    --overlay-padding-mobile: {{ section.settings.overlay_padding_mobile }}px;

    --caret-size: {{ section.settings.caret_size }}px;
    --caret-spacing: {{ section.settings.caret_spacing }}px;
    --caret-margin: {{ section.settings.caret_margin }}px;

    --nav-font-size-mobile: {{ section.settings.nav_font_size_mobile }}px;
    --nav-item-padding-mobile: {{ section.settings.nav_item_padding_mobile }}px;
    --nav-item-spacing-mobile: {{ section.settings.nav_item_spacing_mobile }}px;
    --dropdown-indent-mobile: {{ section.settings.dropdown_indent_mobile }}px;

    --hamburger-color: {{ section.settings.hamburger_color }};

    --overlay-header-rainbow-transition: 0.35s ease;
  }

  /* Per-instance gradient fill mapping to unique gradient id */
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg path,
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg rect,
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg circle,
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg ellipse,
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg polygon,
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg polyline,
  .main-overlay-header[data-overlay-id="{{ overlay_id }}"] .mh-rainbow-active svg line {
    fill: url(#mh-rainbow-icon-gradient-{{ overlay_id }});
  }
</style>

<main-overlay-header-{{ overlay_id }} class="main-overlay-header main-overlay-header-{{ overlay_id }}" data-section-id="{{ section.id }}" data-overlay-id="{{ overlay_id }}">
  <svg aria-hidden="true" focusable="false" width="0" height="0" style="position:absolute; left:0; top:0; pointer-events:none;">
    <defs>
      <linearGradient id="mh-rainbow-icon-gradient-{{ overlay_id }}" class="main-overlay-header-gradient-{{ overlay_id }}" x1="0" y1="0" x2="1" y2="0" gradientUnits="objectBoundingBox">
        <stop offset="0%"   stop-color="#ff0000" style="--ai-overlay-stop-index: 0; --ai-overlay-stop-color: #ff0000;"></stop>
        <stop offset="16%"  stop-color="#ff8000" style="--ai-overlay-stop-index: 1; --ai-overlay-stop-color: #ff8000;"></stop>
        <stop offset="33%"  stop-color="#ffff00" style="--ai-overlay-stop-index: 2; --ai-overlay-stop-color: #ffff00;"></stop>
        <stop offset="50%"  stop-color="#00ff00" style="--ai-overlay-stop-index: 3; --ai-overlay-stop-color: #00ff00;"></stop>
        <stop offset="66%"  stop-color="#0000ff" style="--ai-overlay-stop-index: 4; --ai-overlay-stop-color: #0000ff;"></stop>
        <stop offset="83%"  stop-color="#8000ff" style="--ai-overlay-stop-index: 5; --ai-overlay-stop-color: #8000ff;"></stop>
        <stop offset="100%" stop-color="#ff00ff" style="--ai-overlay-stop-index: 6; --ai-overlay-stop-color: #ff00ff;"></stop>
      </linearGradient>
    </defs>
  </svg>

  <div class="main-overlay-header-container-{{ overlay_id }}">
    {% render 'header-core', section: section, overlay_id: overlay_id %}

    <button class="main-overlay-header-hamburger-{{ overlay_id }}" type="button" aria-label="Toggle menu" aria-controls="main-overlay-{{ overlay_id }}">
      <span class="main-overlay-header-hamburger-line-{{ overlay_id }}"></span>
      <span class="main-overlay-header-hamburger-line-{{ overlay_id }}"></span>
      <span class="main-overlay-header-hamburger-line-{{ overlay_id }}"></span>
    </button>
  </div>

  <div id="main-overlay-{{ overlay_id }}" class="main-overlay-header-mobile-overlay-{{ overlay_id }} overlay-sections mobile">
    <div class="main-overlay-header-mobile-overlay-content-{{ overlay_id }}">
      {% if section.settings.menu and section.settings.menu.links.size > 0 %}
      <ul class="main-overlay-header-mobile-nav-{{ overlay_id }}">
        {% for link in section.settings.menu.links %}
          <li class="main-overlay-header-mobile-nav-item-{{ overlay_id }}">
            <a href="{{ link.url }}" class="main-overlay-header-mobile-nav-link-{{ overlay_id }}" data-has-dropdown="{% if link.links.size > 0 %}true{% else %}false{% endif %}">
              <span class="main-overlay-header-mobile-nav-label-{{ overlay_id }}">{{ link.title }}</span>
              {% if link.links.size > 0 %}
                <span class="main-overlay-header-caret-{{ overlay_id }}">
                  {% if section.settings.custom_caret_icon %}
                    {{ section.settings.custom_caret_icon | image_url: width: 20 | image_tag: alt: 'Dropdown', loading: 'lazy' }}
                  {% else %}
                    <span class="main-overlay-header-caret-symbol-{{ overlay_id }}">â–¼</span>
                  {% endif %}
                </span>
              {% endif %}
            </a>
            {% if link.links.size > 0 %}
              <div class="main-overlay-header-mobile-dropdown-{{ overlay_id }}">
                {% for child_link in link.links %}
                  <a href="{{ child_link.url }}" class="main-overlay-header-mobile-dropdown-link-{{ overlay_id }}">
                    {{ child_link.title }}
                  </a>
                {% endfor %}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
      {% endif %}

      <div class="main-overlay-header-mobile-icons-{{ overlay_id }}">
        <a href="{{ routes.search_url }}" class="header__icon main-overlay-header-icon-{{ overlay_id }} main-overlay-header-search-icon-{{ overlay_id }}">
          <span class="icon-wrapper">
            {% if section.settings.custom_search_icon %}
              {{ section.settings.custom_search_icon | image_url: width: 30 | image_tag: alt: 'Search', loading: 'lazy' }}
            {% else %}
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            {% endif %}
          </span>
        </a>

        {% if shop.customer_accounts_enabled %}
          <a href="{{ routes.account_url }}" class="header__icon main-overlay-header-icon-{{ overlay_id }} main-overlay-header-account-icon-{{ overlay_id }}">
            <span class="icon-wrapper">
              {% if section.settings.custom_account_icon %}
                {{ section.settings.custom_account_icon | image_url: width: 30 | image_tag: alt: 'Account', loading: 'lazy' }}
              {% else %}
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              {% endif %}
            </span>
          </a>
        {% endif %}

        <a href="{{ routes.cart_url }}" class="header__icon main-overlay-header-icon-{{ overlay_id }} main-overlay-header-cart-icon-{{ overlay_id }}">
          <span class="icon-wrapper">
            {% if section.settings.custom_cart_icon %}
              {{ section.settings.custom_cart_icon | image_url: width: 30 | image_tag: alt: 'Cart', loading: 'lazy' }}
            {% else %}
              <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
                <g transform="translate(0.5,0.5) scale(0.96)">
                  <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.19 2 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                </g>
              </svg>
            {% endif %}
          </span>
        </a>
      </div>
    </div>
  </div>
</main-overlay-header-{{ overlay_id }}>



{% schema %}
{
  "name": "Main overlay header",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "range",
      "id": "logo_height_mobile",
      "min": 20,
      "max": 80,
      "step": 5,
      "unit": "px",
      "label": "Logo height mobile",
      "default": 40
    },
    {
      "type": "range",
      "id": "logo_height_desktop",
      "min": 30,
      "max": 120,
      "step": 5,
      "unit": "px",
      "label": "Logo height desktop",
      "default": 60
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "range",
      "id": "nav_font_size_mobile",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Nav font size mobile",
      "default": 18
    },
    {
      "type": "range",
      "id": "nav_font_size_desktop",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Nav font size desktop",
      "default": 16
    },
    {
      "type": "select",
      "id": "nav_font_weight",
      "label": "Nav font weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi-bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "500"
    },
    {
      "type": "range",
      "id": "nav_item_spacing_mobile",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Nav item spacing mobile",
      "default": 20
    },
    {
      "type": "range",
      "id": "nav_item_spacing_desktop",
      "min": 15,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Nav item spacing desktop",
      "default": 30
    },
    {
      "type": "range",
      "id": "nav_item_padding_mobile",
      "min": 5,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Nav item padding mobile",
      "default": 10
    },
    {
      "type": "range",
      "id": "nav_item_padding_desktop",
      "min": 5,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Nav item padding desktop",
      "default": 12
    },
    {
      "type": "range",
      "id": "nav_spacing_desktop",
      "min": 20,
      "max": 80,
      "step": 5,
      "unit": "px",
      "label": "Nav spacing from edges desktop",
      "default": 40
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "header_height_mobile",
      "min": 60,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Header height mobile",
      "default": 70
    },
    {
      "type": "range",
      "id": "header_height_desktop",
      "min": 70,
      "max": 120,
      "step": 5,
      "unit": "px",
      "label": "Header height desktop",
      "default": 90
    },
    {
      "type": "range",
      "id": "header_margin_mobile",
      "min": 10,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Header margin mobile",
      "default": 16
    },
    {
      "type": "range",
      "id": "header_margin_desktop",
      "min": 15,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Header margin desktop",
      "default": 25
    },
    {
      "type": "range",
      "id": "overlay_padding_mobile",
      "min": 15,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Overlay padding mobile",
      "default": 25
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "label": "Header background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "header_border_color",
      "label": "Header border color",
      "default": "#e0e0e0"
    },
    {
      "type": "range",
      "id": "header_border_thickness",
      "min": 0,
      "max": 5,
      "step": 1,
      "unit": "px",
      "label": "Header border thickness",
      "default": 1
    },
    {
      "type": "color",
      "id": "nav_text_color",
      "label": "Nav text color",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "overlay_bg_color",
      "label": "Mobile overlay background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "overlay_text_color",
      "label": "Mobile overlay text color",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "hamburger_color",
      "label": "Hamburger menu color",
      "default": "#121212"
    },
    {
      "type": "header",
      "content": "Dropdown"
    },
    {
      "type": "color",
      "id": "dropdown_bg_color",
      "label": "Dropdown background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "dropdown_border_color",
      "label": "Dropdown border color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "dropdown_text_color",
      "label": "Dropdown text color",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "dropdown_hover_bg_color",
      "label": "Dropdown hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "dropdown_hover_text_color",
      "label": "Dropdown hover text color",
      "default": "#121212"
    },
    {
      "type": "range",
      "id": "dropdown_border_radius",
      "min": 0,
      "max": 15,
      "step": 1,
      "unit": "px",
      "label": "Dropdown border radius",
      "default": 4
    },
    {
      "type": "range",
      "id": "dropdown_font_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Dropdown font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "dropdown_indent_mobile",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Dropdown indent mobile",
      "default": 20
    },
    {
      "type": "header",
      "content": "Icons"
    },
    {
      "type": "image_picker",
      "id": "custom_search_icon",
      "label": "Custom search icon"
    },
    {
      "type": "image_picker",
      "id": "custom_account_icon",
      "label": "Custom account icon"
    },
    {
      "type": "image_picker",
      "id": "custom_cart_icon",
      "label": "Custom cart icon"
    },
    {
      "type": "image_picker",
      "id": "custom_caret_icon",
      "label": "Custom caret icon"
    },
    {
      "type": "range",
      "id": "icon_size_mobile",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Icon size mobile",
      "default": 24
    },
    {
      "type": "range",
      "id": "icon_size_desktop",
      "min": 18,
      "max": 36,
      "step": 2,
      "unit": "px",
      "label": "Icon size desktop",
      "default": 26
    },
    {
      "type": "range",
      "id": "icon_spacing",
      "min": 5,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Icon spacing",
      "default": 12
    },
    {
      "type": "header",
      "content": "Search icon colors"
    },
    {
      "type": "color",
      "id": "search_icon_color_desktop",
      "label": "Search icon color desktop",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "search_icon_hover_color_desktop",
      "label": "Search icon hover color desktop",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Account icon colors"
    },
    {
      "type": "color",
      "id": "account_icon_color_desktop",
      "label": "Account icon color desktop",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "account_icon_hover_color_desktop",
      "label": "Account icon hover color desktop",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Cart icon colors"
    },
    {
      "type": "color",
      "id": "cart_icon_color_desktop",
      "label": "Cart icon color desktop",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "cart_icon_hover_color_desktop",
      "label": "Cart icon hover color desktop",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Caret"
    },
    {
      "type": "range",
      "id": "caret_size",
      "min": 8,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Caret size",
      "default": 12
    },
    {
      "type": "range",
      "id": "caret_spacing",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Caret spacing",
      "default": 4
    },
    {
      "type": "range",
      "id": "caret_margin",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Caret margin",
      "default": 2
    }
  ],
  "presets": [
    {
      "name": "Main overlay header"
    }
  ]
}
{% endschema %}
