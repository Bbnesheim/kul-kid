{% assign block_uid = block.id | replace: '_', '' | downcase %}

{% comment %} Kids Hero Block (snippet) {% endcomment %}
{% assign ai_gen_id = block_uid %}

{% style %}
  .ai-kids-hero-{{ ai_gen_id }} {
    width: 100%;
    position: relative;
    overflow: visible;
    --hero-radius: {{ block.settings.hero_radius }}px;
    --kk-red: #D84E4E;
    --kk-yellow: #F3C52D;
    --kk-blue: #4E79B9;
    --kk-green: #2FA34A;
    --kk-orange: #DC7A2C;
    --kk-purple: #7E59B5;
  }

  .kk-hero-track {
    display: flex;
    gap: 24px;
    overflow: visible;
    padding: 0;
    margin-bottom: {{ block.settings.categories_margin_top }}px;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .kk-hero-track::-webkit-scrollbar { display: none; }

  .kk-hero-slide {
    flex: 1 1 0;
    border-radius: var(--hero-radius, 0px);
    overflow: hidden;
    position: relative;
    min-height: {{ block.settings.hero_height }}px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  .kk-hero-slide img { display:block; width:100%; height:100%; object-fit:cover; border-radius:0; }

  .ai-hero-overlay-{{ ai_gen_id }} {
    position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0, {{ block.settings.overlay_opacity | divided_by: 100.0 }}) 100%);
  }
  .ai-hero-content-{{ ai_gen_id }} { position:absolute; inset:auto 0 24px 24px; color: {{ block.settings.text_color }}; z-index:2; }
  .ai-hero-title-{{ ai_gen_id }} { font-size: {{ block.settings.title_size }}px; font-weight:700; margin:0 0 8px; line-height:1.2; }
  .ai-hero-description-{{ ai_gen_id }} { font-size: {{ block.settings.description_size }}px; margin:0 0 16px; line-height:1.4; opacity:.9; }
  .ai-hero-button-{{ ai_gen_id }} {
    display:inline-block; padding:12px 24px; background: {{ block.settings.button_bg_color }}; color: {{ block.settings.button_text_color }}; text-decoration:none; border-radius: {{ block.settings.button_border_radius }}px; font-weight:600; font-size:14px; transition:.3s; border:none; cursor:pointer;
  }
  .ai-hero-button-{{ ai_gen_id }}:hover { background: {{ block.settings.button_hover_color }}; transform: translateY(-2px); }

  .ai-categories-section-{{ ai_gen_id }} { margin-top: {{ block.settings.categories_margin_top }}px; margin-bottom: {{ block.settings.categories_margin_bottom }}px; overflow:visible; position:relative; }
  .ai-categories-wrapper-{{ ai_gen_id }} { position:relative; width:100%; max-width:1280px; margin:0 auto; }
  .kk-category-scroller-wrap { position:relative; }
  .kk-swipe-hint { display:none; }

  .kk-category-scroller {
    --col-width:136px; --gap-y:24px; --gap-x:28px;
    display:grid; grid-auto-flow:column; grid-template-rows:repeat(2,auto); grid-auto-columns:var(--col-width);
    gap: var(--gap-y) var(--gap-x);
    overflow-x:auto; overflow-y:hidden; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; touch-action: pan-x pan-y;
    padding-inline:16px; scroll-padding-inline:16px; scrollbar-width:none; -ms-overflow-style:none; scroll-behavior:smooth;
  }
  .kk-category-scroller::-webkit-scrollbar { display:none; }

  .kk-category-item { width:var(--col-width); scroll-snap-align:start; text-align:center; text-decoration:none; color: {{ block.settings.category_text_color }}; transition: transform .3s; display:grid; place-items:center; }
  .kk-category-item:hover { transform: translateY(-4px); }
  .kk-category-item__img { width:120px; height:120px; border-radius:9999px; overflow:hidden; background: {{ block.settings.category_bg_color }}; box-shadow:0 2px 8px rgba(0,0,0,.06); display:grid; place-items:center; background-size:cover; background-position:center; background-repeat:no-repeat; transition:.3s; }
  .kk-category-item:hover .kk-category-item__img { box-shadow:0 6px 20px rgba(0,0,0,.15); transform: scale(1.05); }
  .kk-category-item__img img { width:100%; height:100%; object-fit:cover; }
  .ai-category-placeholder-{{ ai_gen_id }} { width:100%; height:100%; background:#f4f4f4; display:flex; align-items:center; justify-content:center; }
  .ai-category-placeholder-{{ ai_gen_id }} svg { width:50%; height:50%; opacity:.5; }
  .kk-category-item__label { font-size:14px; margin-top:8px; line-height:1.2; font-weight:600; }

  .ai-scroll-arrow-{{ ai_gen_id }} { display:none; position:absolute; top:50%; transform:translateY(-50%); width:48px; height:48px; background:#fff; border:none; border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.15); cursor:pointer; z-index:10; transition:.3s; align-items:center; justify-content:center; }
  .ai-scroll-arrow-{{ ai_gen_id }}:hover { box-shadow:0 6px 20px rgba(0,0,0,.25); transform: translateY(-50%) scale(1.05); }
  .ai-scroll-arrow-{{ ai_gen_id }}:active { transform: translateY(-50%) scale(0.95); }
  .ai-scroll-arrow-left-{{ ai_gen_id }} { left:-24px; }
  .ai-scroll-arrow-right-{{ ai_gen_id }} { right:-24px; }
  .ai-scroll-arrow-{{ ai_gen_id }} svg { width:20px; height:20px; color:#333; }

  .kk-category-scroller .slick-dots, .kk-category-scroller .swiper-pagination, .kk-category-scroller .slider__dots { display:none!important; }

  @media (max-width: 767px){
    .kk-category-scroller-wrap { position:relative; }
    .kk-hero-track { display:flex; gap:16px; padding-left:0; padding-right:16px; scroll-padding-left:0; scroll-padding-right:16px; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; touch-action: pan-x pan-y; --peek-right:40px; }
    .kk-hero-slide { flex:0 0 calc(100% - var(--peek-right)); scroll-snap-align:start; border-radius: var(--hero-radius, 0px); overflow:hidden; background:#fff; }
    .ai-hero-title-{{ ai_gen_id }} { font-size: {{ block.settings.title_size | times: 0.8 }}px; }
    .ai-hero-description-{{ ai_gen_id }} { font-size: {{ block.settings.description_size | times: 0.9 }}px; }
    .ai-hero-content-{{ ai_gen_id }} { inset:auto 0 16px 16px; }
    .kk-category-scroller { --col-width:110px; --gap-y:20px; --gap-x:22px; }
    .kk-category-item__img { width:96px; height:96px; }
    .kk-swipe-hint { display:block; position:absolute; left:50%; transform:translateX(-50%); top:-6px; padding:3px 10px; border-radius:9999px; background:rgba(0,0,0,.06); backdrop-filter:blur(2px); font-size:14px; letter-spacing:3px; line-height:1; opacity:.95; transition:opacity .3s; pointer-events:none; }
    .kk-swipe-hint.is-hidden { opacity:0; }
  }
  @media (min-width:768px){ .kk-hero-track{ overflow:visible; gap:24px; padding:0; } .kk-hero-slide{ flex:1 1 0; border-radius: var(--hero-radius, 0px);} .kk-category-scroller{ --col-width:136px; --gap-y:24px; --gap-x:28px; } }
  @media (min-width:992px){
    .kk-category-scroller{ --col-width:176px; --gap-y:32px; --gap-x:40px; padding-inline:24px; scroll-padding-inline:24px; overflow-y:hidden; }
    .kk-category-item{ width:var(--col-width); }
    .kk-category-item__img{ width:160px; height:160px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
    .kk-category-item:hover{ transform:none; }
    .kk-category-item:hover .kk-category-item__img{ transform:none; box-shadow:0 4px 12px rgba(0,0,0,.08); }
    .kk-category-item__label{ font-size:15px; margin-top:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: var(--col-width); }
    .ai-scroll-arrow-{{ ai_gen_id }}{ display:flex; top:50%; transform:translateY(-50%); }
    .ai-scroll-arrow-left-{{ ai_gen_id }}{ left:-8px; }
    .ai-scroll-arrow-right-{{ ai_gen_id }}{ right:-8px; }
  }
  @media (max-width:600px){
    .ai-hero-title-{{ ai_gen_id }} { font-size: {{ block.settings.title_size | times: 0.7 }}px; }
    .ai-hero-description-{{ ai_gen_id }} { font-size: {{ block.settings.description_size | times: 0.8 }}px; }
    .ai-hero-content-{{ ai_gen_id }} { inset:auto 0 12px 12px; }
    .kk-category-scroller{ --col-width:100px; --gap-y:18px; --gap-x:20px; }
    .kk-category-item__img{ width:80px; height:80px; }
    .kk-category-item__label{ font-size:13px; }
  }
{% endstyle %}

<kids-hero-{{ ai_gen_id }} class="ai-kids-hero-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="kk-hero-track">
    {% for i in (1..3) %}
      {% liquid
        assign image_key = 'hero_image_' | append: i
        assign title_key = 'hero_title_' | append: i
        assign description_key = 'hero_description_' | append: i
        assign button_text_key = 'hero_button_text_' | append: i
        assign button_link_key = 'hero_button_link_' | append: i
        assign hero_image = block.settings[image_key]
        assign hero_title = block.settings[title_key]
        assign hero_description = block.settings[description_key]
        assign hero_button_text = block.settings[button_text_key]
        assign hero_button_link = block.settings[button_link_key]
      %}
      <div class="kk-hero-slide"
        {% if hero_image %}style="background-image:url('{{ hero_image | image_url: width: 800 }}');"{% else %}style="background-color:#f4f4f4;"{% endif %}>
        {% if hero_image %}
          <img src="{{ hero_image | image_url: width: 800 }}" alt="{{ hero_image.alt | escape }}" loading="lazy" width="{{ hero_image.width }}" height="{{ hero_image.height }}">
        {% endif %}
        <div class="ai-hero-overlay-{{ ai_gen_id }}"></div>
        <div class="ai-hero-content-{{ ai_gen_id }}">
          {% if hero_title != blank %}<h2 class="ai-hero-title-{{ ai_gen_id }}">{{ hero_title }}</h2>{% endif %}
          {% if hero_description != blank %}<p class="ai-hero-description-{{ ai_gen_id }}">{{ hero_description }}</p>{% endif %}
          {% if hero_button_text != blank and hero_button_link != blank %}
            <a href="{{ hero_button_link }}" class="ai-hero-button-{{ ai_gen_id }}">{{ hero_button_text }}</a>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="ai-categories-section-{{ ai_gen_id }}">
    <div class="ai-categories-wrapper-{{ ai_gen_id }}">
      <div class="kk-category-scroller-wrap">
        <div class="kk-swipe-hint" aria-hidden="true">
          <i style="color:var(--kk-red)">•</i><i style="color:var(--kk-yellow)">•</i><i style="color:var(--kk-blue)">•</i><i style="color:var(--kk-green)">•</i><i style="color:var(--kk-orange)">•</i><i style="color:var(--kk-purple)">•</i>
        </div>
        <button class="ai-scroll-arrow-{{ ai_gen_id }} ai-scroll-arrow-left-{{ ai_gen_id }}" aria-label="Scroll left">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        </button>
        <div class="kk-category-scroller">
          {% for i in (1..40) %}
            {% liquid
              assign category_name_key = 'category_' | append: i | append: '_name'
              assign category_image_key = 'category_' | append: i | append: '_image'
              assign category_link_key = 'category_' | append: i | append: '_link'
              assign category_name = block.settings[category_name_key]
              assign category_image = block.settings[category_image_key]
              assign category_link = block.settings[category_link_key]
            %}
            {% if category_name != blank %}
              <a href="{{ category_link | default: '#' }}" class="kk-category-item">
                <div class="kk-category-item__img" {% if category_image %}style="background-image:url('{{ category_image | image_url: width: 200 }}');"{% endif %}>
                  {% unless category_image %}
                    <div class="ai-category-placeholder-{{ ai_gen_id }}">{{ 'image' | placeholder_svg_tag }}</div>
                  {% endunless %}
                </div>
                <span class="kk-category-item__label">{{ category_name }}</span>
              </a>
            {% endif %}
          {% endfor %}
        </div>
        <button class="ai-scroll-arrow-{{ ai_gen_id }} ai-scroll-arrow-right-{{ ai_gen_id }}" aria-label="Scroll right">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </button>
      </div>
    </div>
  </div>
</kids-hero-{{ ai_gen_id }}>

<script>
  (function(){
    class KidsHero{{ ai_gen_id }} extends HTMLElement {
      connectedCallback(){ this.setupCategoryScroller(); this.removeSliderHooks(); this.setupScrollArrows(); this.setupSwipeHint(); }
      setupCategoryScroller(){ const scroller=this.querySelector('.kk-category-scroller'); if(!scroller) return; scroller.classList.remove('slider','swiper','slick'); scroller.removeAttribute('data-slider'); const dots=scroller.parentElement.querySelectorAll('.slick-dots,.swiper-pagination,.slider__dots'); dots.forEach(d=>d.remove()); }
      setupScrollArrows(){ const scroller=this.querySelector('.kk-category-scroller'); const left=this.querySelector('.ai-scroll-arrow-left-{{ ai_gen_id }}'); const right=this.querySelector('.ai-scroll-arrow-right-{{ ai_gen_id }}'); if(!scroller||!left||!right) return; const getAmt=()=>{ const w=scroller.clientWidth; const gap=window.innerWidth>=992?40:(window.innerWidth>=768?28:22); return w-(2*gap); }; left.addEventListener('click',()=>scroller.scrollBy({left:-getAmt(),behavior:'smooth'})); right.addEventListener('click',()=>scroller.scrollBy({left:getAmt(),behavior:'smooth'})); const vis=()=>{ const {scrollLeft,scrollWidth,clientWidth}=scroller; left.style.opacity=scrollLeft<=8?'0':'1'; left.style.pointerEvents=scrollLeft<=8?'none':'auto'; left.style.visibility=scrollLeft<=8?'hidden':'visible'; const max=scrollWidth-clientWidth; const end=scrollLeft>=max-8; right.style.opacity=end?'0':'1'; right.style.pointerEvents=end?'none':'auto'; right.style.visibility=end?'hidden':'visible'; }; scroller.addEventListener('scroll',vis); window.addEventListener('resize',vis); vis(); }
      setupSwipeHint(){ const wrap=this.querySelector('.kk-category-scroller-wrap'); if(!wrap) return; const scroller=wrap.querySelector('.kk-category-scroller'); const hint=wrap.querySelector('.kk-swipe-hint'); if(!hint||!scroller) return; let seen=false; scroller.addEventListener('scroll',()=>{ if(seen) return; if(scroller.scrollLeft>10){ seen=true; hint.classList.add('is-hidden'); } },{passive:true}); }
      removeSliderHooks(){ const track=this.querySelector('.kk-hero-track'); if(!track) return; track.classList.remove('slider','swiper','slick','carousel'); track.removeAttribute('data-slider'); track.removeAttribute('data-slick'); track.removeAttribute('data-swiper'); track.removeAttribute('data-carousel'); const dots=track.parentElement.querySelectorAll('.slick-dots,.swiper-pagination,.slider__dots,.carousel-dots'); dots.forEach(d=>d.remove()); const arrows=track.parentElement.querySelectorAll('.slick-arrow,.swiper-button-prev,.swiper-button-next,.carousel-arrow'); arrows.forEach(a=>a.remove()); }
    }
    customElements.define('kids-hero-{{ ai_gen_id }}', KidsHero{{ ai_gen_id }});
    document.querySelectorAll('.kk-category-scroller').forEach(s=>{ s.classList.remove('slider','swiper','slick'); s.removeAttribute('data-slider'); const dots=s.parentElement.querySelectorAll('.slick-dots,.swiper-pagination,.slider__dots'); dots.forEach(d=>d.remove()); });
    document.querySelectorAll('.kk-hero-track').forEach(t=>{ t.classList.remove('slider','swiper','slick','carousel'); t.removeAttribute('data-slider'); t.removeAttribute('data-slick'); t.removeAttribute('data-swiper'); t.removeAttribute('data-carousel'); const dots=t.parentElement.querySelectorAll('.slick-dots,.swiper-pagination,.slider__dots,.carousel-dots'); dots.forEach(d=>d.remove()); const arrows=t.parentElement.querySelectorAll('.slick-arrow,.swiper-button-prev,.swiper-button-next,.carousel-arrow'); arrows.forEach(a=>a.remove()); });
  })();
</script>
