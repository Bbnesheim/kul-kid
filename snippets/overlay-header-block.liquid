{% assign block_uid = block.id | replace: '_', '' | downcase %}
{% assign ai_gen_id = block_uid %}

{% comment %} Overlay Header Block (snippet) {% endcomment %}

{% style %}
  .ai-overlay-header-{{ ai_gen_id }} { --kk-icon-size-desktop: {{ block.settings.icon_size_desktop | default: 28 }}px; --kk-icon-size-mobile: {{ block.settings.icon_size_mobile | default: 24 }}px; --ai-overlay-header-rainbow-gradient: linear-gradient(90deg,#ff0000,#ff8000,#ffff00,#80ff00,#00ff00,#00ff80,#00ffff,#0080ff,#0000ff,#8000ff,#ff00ff,#ff0080); --ai-overlay-header-rainbow-transition:.35s ease; position:relative; width:100%; background: {{ block.settings.header_bg_color }}; border-bottom: {{ block.settings.header_border_thickness }}px solid {{ block.settings.header_border_color }}; z-index:1000; }
  .ai-overlay-header-container-{{ ai_gen_id }} { display:flex; align-items:center; justify-content:space-between; padding: {{ block.settings.header_margin_mobile }}px; height: {{ block.settings.header_height_mobile }}px; max-width: {{ settings.page_width }}px; margin:0 auto; position:relative; z-index:1002; background: inherit; }
  .ai-overlay-header-logo-{{ ai_gen_id }} img { height: {{ block.settings.logo_height_mobile }}px; width:auto; }
  .ai-overlay-header-nav-desktop-{{ ai_gen_id }} { display:none; flex:1; justify-content:center; margin:0 {{ block.settings.nav_spacing_desktop }}px; }
  .ai-overlay-header-nav-list-{{ ai_gen_id }} { display:flex; list-style:none; margin:0; padding:0; gap: {{ block.settings.nav_item_spacing_desktop }}px; align-items:center; }
  .ai-overlay-header-nav-link-{{ ai_gen_id }} { color: {{ block.settings.nav_text_color }}; text-decoration:none; font-size: {{ block.settings.nav_font_size_desktop }}px; font-weight: {{ block.settings.nav_font_weight }}; padding: {{ block.settings.nav_item_padding_desktop }}px; display:block; position:relative; transition: color var(--ai-overlay-header-rainbow-transition), background var(--ai-overlay-header-rainbow-transition); }
  .ai-overlay-header-nav-link-{{ ai_gen_id }}:hover { background: var(--ai-overlay-header-rainbow-gradient); background-size:200% 100%; -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .ai-overlay-header-nav-link-{{ ai_gen_id }}::after { content:''; position:absolute; bottom:0; left:0; width:0; height:2px; background: var(--ai-overlay-header-rainbow-gradient); transition: width var(--ai-overlay-header-rainbow-transition); }
  .ai-overlay-header-nav-link-{{ ai_gen_id }}:hover::after { width:100%; }
  .ai-overlay-header-dropdown-{{ ai_gen_id }} { position:absolute; top:100%; left:0; background: {{ block.settings.dropdown_bg_color }}; border:1px solid {{ block.settings.dropdown_border_color }}; border-radius: {{ block.settings.dropdown_border_radius }}px; box-shadow:0 4px 12px rgba(0,0,0,.1); opacity:0; visibility:hidden; transform:translateY(-10px); transition:.3s; min-width:200px; z-index:1001; }
  .ai-overlay-header-nav-item-{{ ai_gen_id }}:hover .ai-overlay-header-dropdown-{{ ai_gen_id }} { opacity:1; visibility:visible; transform:translateY(0); }
  .ai-overlay-header-dropdown-link-{{ ai_gen_id }} { display:block; padding:12px 16px; color: {{ block.settings.dropdown_text_color }}; text-decoration:none; font-size: {{ block.settings.dropdown_font_size }}px; transition: background-color .3s; }
  .ai-overlay-header-dropdown-link-{{ ai_gen_id }}:hover { background: {{ block.settings.dropdown_hover_bg_color }}; color: {{ block.settings.dropdown_hover_text_color }}; }
  .ai-overlay-header-actions-{{ ai_gen_id }} { display:flex; align-items:center; gap: {{ block.settings.icon_spacing }}px; }
  .ai-overlay-header-hamburger-{{ ai_gen_id }} { display:flex; flex-direction:column; justify-content:center; align-items:center; background:none; border:none; cursor:pointer; padding:0; z-index:1002; position:relative; }
  .ai-overlay-header-hamburger-line-{{ ai_gen_id }} { width:24px; height:2px; background: {{ block.settings.hamburger_color }}; margin:2px 0; transition:.3s; }
  .ai-overlay-header-hamburger-{{ ai_gen_id }}.active .ai-overlay-header-hamburger-line-{{ ai_gen_id }}:nth-child(1){ transform:rotate(45deg) translate(5px,5px);} .ai-overlay-header-hamburger-{{ ai_gen_id }}.active .ai-overlay-header-hamburger-line-{{ ai_gen_id }}:nth-child(2){ opacity:0;} .ai-overlay-header-hamburger-{{ ai_gen_id }}.active .ai-overlay-header-hamburger-line-{{ ai_gen_id }}:nth-child(3){ transform:rotate(-45deg) translate(7px,-6px);}  
  .ai-overlay-header-mobile-overlay-{{ ai_gen_id }} { position:fixed; top:0; left:0; width:100%; height:100vh; background: {{ block.settings.overlay_bg_color }}; z-index:1001; opacity:0; visibility:hidden; transition:.3s; overflow-y:auto; -webkit-overflow-scrolling:touch; }
  .ai-overlay-header-mobile-overlay-{{ ai_gen_id }}.active { opacity:1; visibility:visible; }
  .ai-overlay-header-mobile-overlay-content-{{ ai_gen_id }} { padding: {{ block.settings.overlay_padding_mobile }}px {{ block.settings.header_margin_mobile }}px; }
  .ai-overlay-header-mobile-nav-{{ ai_gen_id }} { list-style:none; margin:0; padding:0; }
  .ai-overlay-header-mobile-nav-item-{{ ai_gen_id }} { margin-bottom: {{ block.settings.nav_item_spacing_mobile }}px; }
  .ai-overlay-header-mobile-nav-link-{{ ai_gen_id }} { display:flex; align-items:center; justify-content:flex-start; gap: {{ block.settings.caret_spacing }}px; width:100%; color: {{ block.settings.overlay_text_color }}; text-decoration:none; font-size: {{ block.settings.nav_font_size_mobile }}px; font-weight: {{ block.settings.nav_font_weight }}; padding: {{ block.settings.nav_item_padding_mobile }}px 0; transition:.3s; }
  .ai-overlay-header-caret-symbol-{{ ai_gen_id }} { display:inline-block; font-size: {{ block.settings.caret_size }}px; line-height:1; background: var(--ai-overlay-header-rainbow-gradient); -webkit-background-clip:text; background-clip:text; color:transparent; }
  .ai-overlay-header-mobile-dropdown-{{ ai_gen_id }} { max-height:0; overflow:hidden; transition:max-height .3s; margin-left: {{ block.settings.dropdown_indent_mobile }}px; }
  .ai-overlay-header-mobile-dropdown-{{ ai_gen_id }}.active { max-height:500px; }
  .ai-overlay-header-mobile-dropdown-link-{{ ai_gen_id }} { display:block; color: {{ block.settings.overlay_text_color }}; text-decoration:none; font-size: {{ block.settings.dropdown_font_size }}px; padding:8px 0; opacity:.8; transition:opacity .3s; }
  .ai-overlay-header-mobile-dropdown-link-{{ ai_gen_id }}:hover { opacity:1; }
  .ai-overlay-header-mobile-icons-{{ ai_gen_id }} { display:flex; justify-content:center; gap: {{ block.settings.icon_spacing }}px; margin-top:30px; padding-top:20px; border-top:1px solid {{ block.settings.dropdown_border_color }}; }
  @media(min-width:750px){ .ai-overlay-header-container-{{ ai_gen_id }}{ padding: {{ block.settings.header_margin_desktop }}px; height: {{ block.settings.header_height_desktop }}px; } .ai-overlay-header-logo-{{ ai_gen_id }} img{ height: {{ block.settings.logo_height_desktop }}px;} .ai-overlay-header-nav-desktop-{{ ai_gen_id }}{ display:flex;} .ai-overlay-header-hamburger-{{ ai_gen_id }}{ display:none;} }
{% endstyle %}

<overlay-header-{{ ai_gen_id }} class="ai-overlay-header-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <svg aria-hidden="true" focusable="false" width="0" height="0" style="position:absolute; left:0; top:0; pointer-events:none;">
    <defs>
      <linearGradient id="ai-rainbow-icon-gradient-{{ ai_gen_id }}" class="ai-overlay-header-gradient-{{ ai_gen_id }}" x1="0" y1="0" x2="1" y2="0" gradientUnits="objectBoundingBox">
        <stop offset="0%" stop-color="#ff0000"></stop>
        <stop offset="16%" stop-color="#ff8000"></stop>
        <stop offset="33%" stop-color="#ffff00"></stop>
        <stop offset="50%" stop-color="#00ff00"></stop>
        <stop offset="66%" stop-color="#0000ff"></stop>
        <stop offset="83%" stop-color="#8000ff"></stop>
        <stop offset="100%" stop-color="#ff00ff"></stop>
      </linearGradient>
    </defs>
  </svg>

  <div class="ai-overlay-header-container-{{ ai_gen_id }}">
    <div class="ai-overlay-header-logo-{{ ai_gen_id }}">
      <a href="{{ routes.root_url }}">
        {% if block.settings.logo %}
          {{ block.settings.logo | image_url: width: 300 | image_tag: alt: shop.name, loading: 'lazy' }}
        {% else %}
          {{ settings.logo | image_url: width: 300 | image_tag: alt: shop.name, loading: 'lazy' }}
        {% endif %}
      </a>
    </div>

    <nav class="ai-overlay-header-nav-desktop-{{ ai_gen_id }}">
      <ul class="ai-overlay-header-nav-list-{{ ai_gen_id }}">
        {% if block.settings.menu and block.settings.menu.links.size > 0 %}
          {% for link in block.settings.menu.links %}
            <li class="ai-overlay-header-nav-item-{{ ai_gen_id }}">
              <a href="{{ link.url }}" class="ai-overlay-header-nav-link-{{ ai_gen_id }}">{{ link.title }}</a>
              {% if link.links.size > 0 %}
                <div class="ai-overlay-header-dropdown-{{ ai_gen_id }}">
                  {% for child_link in link.links %}
                    <a href="{{ child_link.url }}" class="ai-overlay-header-dropdown-link-{{ ai_gen_id }}">{{ child_link.title }}</a>
                  {% endfor %}
                </div>
              {% endif %}
            </li>
          {% endfor %}
        {% endif %}
      </ul>
    </nav>

    <div class="ai-overlay-header-actions-{{ ai_gen_id }}">
      <button class="ai-overlay-header-hamburger-{{ ai_gen_id }}" aria-label="Toggle menu">
        <span class="ai-overlay-header-hamburger-line-{{ ai_gen_id }}"></span>
        <span class="ai-overlay-header-hamburger-line-{{ ai_gen_id }}"></span>
        <span class="ai-overlay-header-hamburger-line-{{ ai_gen_id }}"></span>
      </button>
    </div>
  </div>

  <div class="ai-overlay-header-mobile-overlay-{{ ai_gen_id }}">
    <div class="ai-overlay-header-mobile-overlay-content-{{ ai_gen_id }}">
      {% if block.settings.menu and block.settings.menu.links.size > 0 %}
      <ul class="ai-overlay-header-mobile-nav-{{ ai_gen_id }}">
        {% for link in block.settings.menu.links %}
          <li class="ai-overlay-header-mobile-nav-item-{{ ai_gen_id }}">
            <a href="{{ link.url }}" class="ai-overlay-header-mobile-nav-link-{{ ai_gen_id }}" data-has-dropdown="{% if link.links.size > 0 %}true{% else %}false{% endif %}">
              <span class="ai-overlay-header-mobile-nav-label-{{ ai_gen_id }}">{{ link.title }}</span>
              {% if link.links.size > 0 %}
                <span class="ai-overlay-header-caret-{{ ai_gen_id }}">
                  {% if block.settings.custom_caret_icon %}
                    {{ block.settings.custom_caret_icon | image_url: width: 20 | image_tag: alt: 'Dropdown', loading: 'lazy' }}
                  {% else %}
                    <span class="ai-overlay-header-caret-symbol-{{ ai_gen_id }}">â–¼</span>
                  {% endif %}
                </span>
              {% endif %}
            </a>
            {% if link.links.size > 0 %}
              <div class="ai-overlay-header-mobile-dropdown-{{ ai_gen_id }}">
                {% for child_link in link.links %}
                  <a href="{{ child_link.url }}" class="ai-overlay-header-mobile-dropdown-link-{{ ai_gen_id }}">{{ child_link.title }}</a>
                {% endfor %}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
      {% endif %}

      <div class="ai-overlay-header-mobile-icons-{{ ai_gen_id }}">
        {% if block.settings.show_search %}
          <a href="{{ routes.search_url }}" class="header__icon ai-overlay-header-icon-{{ ai_gen_id }} ai-overlay-header-search-icon-{{ ai_gen_id }}"><span class="icon-wrapper">{% if block.settings.custom_search_icon %}{{ block.settings.custom_search_icon | image_url: width: 30 | image_tag: alt: 'Search', loading:'lazy' }}{% else %}<svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>{% endif %}</span></a>
        {% endif %}
        {% if block.settings.show_account %}
          <a href="{{ routes.account_url }}" class="header__icon ai-overlay-header-icon-{{ ai_gen_id }} ai-overlay-header-account-icon-{{ ai_gen_id }}"><span class="icon-wrapper">{% if block.settings.custom_account_icon %}{{ block.settings.custom_account_icon | image_url: width: 30 | image_tag: alt: 'Account', loading:'lazy' }}{% else %}<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>{% endif %}</span></a>
        {% endif %}
        <a href="{{ routes.cart_url }}" class="header__icon ai-overlay-header-icon-{{ ai_gen_id }} ai-overlay-header-cart-icon-{{ ai_gen_id }}"><span class="icon-wrapper">{% if block.settings.custom_cart_icon %}{{ block.settings.custom_cart_icon | image_url: width: 30 | image_tag: alt: 'Cart', loading:'lazy' }}{% else %}<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false"><g transform="translate(0.5,0.5) scale(0.96)"><path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.19 2 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></g></svg>{% endif %}</span></a>
      </div>
    </div>
  </div>
</overlay-header-{{ ai_gen_id }}>

<script>
(function(){
  class OverlayHeader{{ ai_gen_id }} extends HTMLElement {
    constructor(){ super(); this.hamburger=this.querySelector('.ai-overlay-header-hamburger-{{ ai_gen_id }}'); this.overlay=this.querySelector('.ai-overlay-header-mobile-overlay-{{ ai_gen_id }}'); this.mobileNavLinks=this.querySelectorAll('.ai-overlay-header-mobile-nav-link-{{ ai_gen_id }}[data-has-dropdown="true"]'); }
    connectedCallback(){ this.setup(); }
    setup(){ if(this.hamburger&&this.overlay){ this.hamburger.addEventListener('click',()=>this.toggle()); this.mobileNavLinks.forEach(link=>{ if(link.dataset.hasDropdown==='true'){ link.setAttribute('aria-expanded','false'); link.addEventListener('click',(e)=>{ e.preventDefault(); this.toggleDropdown(link); }); } }); } }
    toggle(){ const on=!this.overlay.classList.contains('active'); this.hamburger.classList.toggle('active',on); this.overlay.classList.toggle('active',on); this.hamburger.setAttribute('aria-expanded', on?'true':'false'); document.body.style.overflow = on ? 'hidden' : ''; }
    toggleDropdown(link){ const dd=link.nextElementSibling; if(dd){ dd.classList.toggle('active'); link.classList.toggle('active'); const open=dd.classList.contains('active'); link.setAttribute('aria-expanded', open?'true':'false'); } }
  }
  customElements.define('overlay-header-{{ ai_gen_id }}', OverlayHeader{{ ai_gen_id }});
})();
</script>
